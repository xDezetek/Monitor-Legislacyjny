<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <title>Monitor legislacyjny - RzƒÖd Rzeczypospolitej Polskiej</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="≈öled≈∫ projekty ustaw i uchwa≈Ç, monitoruj konsultacje spo≈Çeczne oraz analizuj wp≈Çyw regulacji legislacyjnych." />

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <!-- Your custom styles (colors, dots, train visuals, overrides) -->
  <link rel="stylesheet" href="style.css" />
</head>
<body class="d-flex flex-column min-vh-100">
  <!-- Top bar -->
  <div class="bg-primary text-white">
    <div class="container py-1">
      <div class="d-flex gap-3 justify-content-center justify-content-md-start small">
        <a class="link-light text-decoration-none" href="https://www.gov.pl">Gov.pl</a>
        <a class="link-light text-decoration-none" href="#help">Pomoc</a>
        <a class="link-light text-decoration-none" href="#accessibility">Dostƒôpno≈õƒá</a>
        <a class="link-light text-decoration-none" href="#contact">Kontakt</a>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="bg-primary text-white sticky-top shadow-sm" role="banner">
    <div class="container">
      <div class="py-3 d-flex flex-column flex-md-row align-items-center gap-3">
        <a href="#" class="d-flex align-items-center gap-2 text-white text-decoration-none">
          <svg width="40" height="40" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M5 3h14a2 2 0 0 1 2 2v3H3V5a2 2 0 0 1 2-2zm-2 8h18v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-8zm5 2v6h2v-6H8zm4 0v6h2v-6h-2zm4 0v6h2v-6h-2z"/>
          </svg>
          <h1 class="h5 m-0">Monitor legislacyjny</h1>
        </a>

        <form class="ms-md-auto" role="search" style="min-width: 260px;">
          <div class="input-group">
            <input type="search" class="form-control" placeholder="Wyszukaj projekt ustawy..." id="globalSearch" />
            <button class="btn btn-light" type="submit" aria-label="Szukaj" onclick="event.preventDefault();">üîç</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Main nav -->
    <nav class="bg-light border-top border-bottom" role="navigation" aria-label="G≈Ç√≥wna nawigacja">
      <div class="container">
        <ul class="nav nav-pills py-1 flex-wrap">
          <li class="nav-item"><a href="#legislative" class="nav-link active nav-link" data-section="legislative">Projekty ustaw</a></li>
          <li class="nav-item"><a href="#consultations" class="nav-link" data-section="consultations">Konsultacje</a></li>
          <li class="nav-item"><a href="#tracking" class="nav-link" data-section="tracking">≈öledzenie zmian</a></li>
          <li class="nav-item"><a href="#impact" class="nav-link" data-section="impact">Analiza wp≈Çywu</a></li>
          <li class="nav-item"><a href="#alerts" class="nav-link" data-section="alerts">Alerty</a></li>
          <li class="nav-item"><a href="#simple" class="nav-link" data-section="simple">Prosty jƒôzyk</a></li>
          <li class="nav-item"><a href="#access" class="nav-link" data-section="access">Dostƒôp u≈ºytkownik√≥w</a></li>
        </ul>
      </div>
    </nav>
  </header>

  <main id="content" class="flex-grow-1">
    <div class="container py-4">

      <!-- Top layout: main + aside -->
      <div class="row g-4">
        <!-- Legislative card -->
        <section class="col-12" id="legislative" aria-labelledby="legislative-title">
          <div class="card">
            <div class="card-body">
              <h2 id="legislative-title" class="h4">Projekty ustaw i uchwa≈Ç</h2>
              <p class="mb-3">Wizualny harmonogram legislacyjny - ≈õled≈∫ projekty na ka≈ºdym etapie prac legislacyjnych, od prekonsultacji do publikacji.</p>

              <!-- Filters -->
              <div class="bg-light p-3 rounded mb-3">
                <div class="row g-3 align-items-end">
                  <div class="col-12 col-md-3">
                    <label for="priority" class="form-label">Temat</label>
                    <select id="priority" class="form-select">
                      <option value="all">Wszystkie tematy</option>
                      <option value="AI">Sztuczna inteligencja</option>
                      <option value="Cybersecurity">Cyberbezpiecze≈Ñstwo</option>
                      <option value="Data">Dane i prywatno≈õƒá</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-3">
                    <label for="stage" class="form-label">Etap procesu</label>
                    <select id="stage" class="form-select">
                      <option value="all">Wszystkie</option>
                      <option value="prekonsultacje">Prekonsultacje</option>
                      <option value="konsultacje">Konsultacje spo≈Çeczne</option>
                      <option value="rzƒÖd">RzƒÖd</option>
                      <option value="sejm">Sejm</option>
                      <option value="senat">Senat</option>
                      <option value="prezydent">Prezydent</option>
                      <option value="publikacja">Publikacja (Dz.U.)</option>
                    </select>
                  </div>
                  <div class="col-12 col-md-4">
                    <label for="search" class="form-label">Wyszukaj projekt</label>
                    <input id="search" type="search" class="form-control" placeholder="np. Ustawa o sztucznej inteligencji" />
                  </div>
                  <div class="col-12 col-md-2">
                    <button class="btn btn-primary w-100" id="resetFilters">Wyczy≈õƒá filtry</button>
                  </div>
                </div>
              </div>

              <!-- Legend -->
              <div class="bg-light p-3 rounded d-flex flex-wrap gap-2 mb-3" aria-label="Legenda etap√≥w">
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot pre"></span>Prekonsultacje</span>
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot consult"></span>Konsultacje</span>
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot gov"></span>RzƒÖd</span>
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot sejm"></span>Sejm</span>
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot senat"></span>Senat</span>
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot prez"></span>Prezydent</span>
                <span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot pub"></span>Publikacja</span>
              </div>

              <!-- Train board -->
              <div id="trainBoard" class="train-board" aria-live="polite"></div>
            </div>
          </div>
        </section>

        <!-- Aside (Quick actions + news). Initially hidden by your JS except on 'access' page. -->
        <aside class="col-12" aria-label="Szybkie akcje" id="quickActionsAside">
          <div class="card">
            <div class="card-body">
              <h2 class="h5">Szybkie akcje</h2>
              <div class="d-grid gap-2" id="quickActions">
                <div class="border rounded p-3" id="quickAddItem">
                  <div class="fw-semibold">‚ûï Nowy projekt</div>
                  <div class="text-muted small">Dodaj nowy projekt do ≈õledzenia</div>
                  <button id="addProjectBtn" class="btn btn-primary w-100 mt-2">Dodaj</button>
                </div>
                <div class="border rounded p-3">
                  <div class="fw-semibold">üîî Konfiguruj alerty</div>
                  <div class="text-muted small">Otrzymuj powiadomienia</div>
                  <button class="btn btn-outline-secondary w-100 mt-2" id="configureAlerts">Ustawienia</button>
                </div>
                <div class="border rounded p-3" id="exportItem">
                  <div class="fw-semibold">üìä Eksportuj raport</div>
                  <div class="text-muted small">PDF, CSV, Excel</div>
                  <button class="btn btn-outline-secondary w-100 mt-2">Eksport</button>
                </div>
              </div>

              <hr class="my-4" />
              <h2 class="h5">Aktualno≈õci</h2>
              <div class="d-grid gap-2" id="dailySummary"></div>
            </div>
          </div>
        </aside>
      </div>

      <!-- Other sections -->
      <section class="mt-4" id="consultations" aria-labelledby="consultations-title">
        <div class="card">
          <div class="card-body">
            <h2 id="consultations-title" class="h4">Konsultacje spo≈Çeczne</h2>
            <p>Monitoruj etapy prekonsultacji i konsultacji. Partycypuj w procesie stanowienia prawa poprzez dodawanie opinii.</p>
            <div class="d-grid gap-2" id="consultationsFeed"></div>
          </div>
        </div>
      </section>

      <section class="mt-4" id="tracking" aria-labelledby="tracking-title">
        <div class="card">
          <div class="card-body">
            <h2 id="tracking-title" class="h4">Integracja i ≈õledzenie zmian</h2>
            <p>Centralne miejsce do monitorowania wszystkich zmian legislacyjnych, aktualizacji tekst√≥w i dokument√≥w.</p>
            <h3 class="h6">Zmiany w ostatnich 7 dniach:</h3>
            <div class="d-grid gap-2" id="changeLog"></div>
            <div class="mt-3 d-flex gap-2 flex-wrap">
              <button class="btn btn-primary" id="viewFullChangelog">Pe≈Çny dziennik zmian</button>
              <button class="btn btn-outline-secondary" id="compareVersions">Por√≥wnaj wersje</button>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-4" id="tracking-console" aria-labelledby="tracking-console-title">
        <div class="card">
          <div class="card-body">
            <h2 id="tracking-console-title" class="h4">Szybkie ≈õledzenie nowych projekt√≥w</h2>
            <p>Automatyczne powiadomienia o nowych projektach na wczesnym etapie prac legislacyjnych, od fazy prekonsultacji.</p>

            <div class="row g-3 mb-3">
              <div class="col-12 col-md-6">
                <label for="trackingScope" class="form-label"><strong>≈öledzenie:</strong></label>
                <select id="trackingScope" class="form-select">
                  <option value="all">Wszystkie projekty</option>
                  <option value="early">Wczesne etapy (prekonsultacje)</option>
                  <option value="consultation">Konsultacje spo≈Çeczne</option>
                  <option value="active">Aktywne prace</option>
                </select>
              </div>
              <div class="col-12 col-md-6">
                <label for="notificationMethod" class="form-label"><strong>Powiadomienia:</strong></label>
                <select id="notificationMethod" class="form-select">
                  <option value="none">Brak</option>
                  <option value="email">E-mail</option>
                  <option value="sms">SMS</option>
                  <option value="both">E-mail + SMS</option>
                </select>
              </div>
            </div>

            <button class="btn btn-primary" id="saveTracking">Zapisz ustawienia</button>
            <div id="trackingStatus" class="mt-3 p-2 rounded" style="background:#d4edda; border:1px solid #c3e6cb; color:#155724; display:none;">
              ‚úì Ustawienia ≈õledzenia zosta≈Çy zapisane
            </div>
          </div>
        </div>
      </section>

      <section class="mt-4" id="impact" aria-labelledby="impact-title">
        <div class="card">
          <div class="card-body">
            <h2 id="impact-title" class="h4">Analiza wp≈Çywu regulacji</h2>
            <p>PrzeglƒÖd szacowanych skutk√≥w dla finans√≥w publicznych, proces√≥w operacyjnych i spo≈Çecze≈Ñstwa.</p>
            <div class="row row-cols-1 row-cols-md-3 g-3" id="impactGrid"></div>
          </div>
        </div>
      </section>

      <section class="mt-4" id="alerts" aria-labelledby="alerts-title">
        <div class="card">
          <div class="card-body">
            <h2 id="alerts-title" class="h4">Alerty i raporty o zmianach</h2>
            <p>Otrzymuj raporty i alerty o istotnych zmianach legislacyjnych. Zwiƒôksza transparentno≈õƒá i pozwala na skuteczne zarzƒÖdzanie ryzykiem.</p>
            <div class="d-grid gap-2" id="alertsFeed"></div>
          </div>
        </div>
      </section>

      <section class="mt-4" id="simple" aria-labelledby="simple-title">
        <div class="card">
          <div class="card-body">
            <h2 id="simple-title" class="h4">Prosty jƒôzyk dla obywateli</h2>
            <p>Narzƒôdzie do t≈Çumaczenia skomplikowanych tekst√≥w urzƒôdowych na prosty, zrozumia≈Çy dla wszystkich jƒôzyk.</p>
            <div>
              <label for="plainInput" class="form-label"><strong>Wklej fragment dokumentu</strong></label>
              <textarea id="plainInput" class="form-control mb-2" placeholder="Wklej z≈Ço≈ºony, formalny akapit..." rows="5"></textarea>
              <button class="btn btn-primary" id="simplifyBtn">Upro≈õƒá jƒôzyk</button>
              <div class="bg-light border rounded p-3 mt-2" id="plainOutput" aria-live="polite" style="min-height:100px; white-space: pre-wrap;"></div>
            </div>
          </div>
        </div>
      </section>

      <section class="mt-4" id="access" aria-labelledby="access-title">
        <div class="card">
          <div class="card-body">
            <h2 id="access-title" class="h4">Dostƒôp dla r√≥≈ºnych u≈ºytkownik√≥w</h2>

            <div class="row g-3 mb-3">
              <div class="col-12 col-md-6">
                <div class="bg-light border rounded p-3 h-100">
                  <h3 class="h6">üëî Urzƒôdnicy</h3>
                  <ul class="mb-0">
                    <li>Pe≈Çny dostƒôp do projekt√≥w</li>
                    <li>Edycja dokument√≥w</li>
                    <li>ZarzƒÖdzanie konsultacjami</li>
                    <li>Raporty i analizy</li>
                  </ul>
                </div>
              </div>
              <div class="col-12 col-md-6">
                <div class="bg-light border rounded p-3 h-100">
                  <h3 class="h6">üë§ Obywatele</h3>
                  <ul class="mb-0">
                    <li>PrzeglƒÖdanie projekt√≥w</li>
                    <li>≈öledzenie zmian</li>
                    <li>Dodawanie uwag</li>
                    <li>Prosty jƒôzyk</li>
                  </ul>
                </div>
              </div>
            </div>

            <div class="d-flex align-items-center gap-2">
              <label for="userRole" class="mb-0"><strong>Twoja rola:</strong></label>
              <select id="userRole" class="form-select w-auto">
                <option value="citizen">Obywatel</option>
                <option value="official">Urzƒôdnik</option>
              </select>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <!-- Footer -->
  <footer role="contentinfo" class="mt-auto bg-dark text-white border-top border-4 border-primary py-4">
    <div class="container text-center">
      <div class="row row-cols-1 row-cols-md-3 g-3 text-start text-white-50">
        <div>
          <h3 class="h6 text-white">Informacje</h3>
          <ul class="list-unstyled mb-0">
            <li><a class="link-warning text-decoration-none" href="#about">O serwisie</a></li>
            <li><a class="link-warning text-decoration-none" href="#faq">Pytania i odpowiedzi</a></li>
            <li><a class="link-warning text-decoration-none" href="#guide">Instrukcja u≈ºytkownika</a></li>
            <li><a class="link-warning text-decoration-none" href="#api">API</a></li>
          </ul>
        </div>
        <div>
          <h3 class="h6 text-white">Bezpiecze≈Ñstwo i prywatno≈õƒá</h3>
          <ul class="list-unstyled mb-0">
            <li><a class="link-warning text-decoration-none" href="#privacy">Polityka prywatno≈õci</a></li>
            <li><a class="link-warning text-decoration-none" href="#cookies">Polityka cookies</a></li>
            <li><a class="link-warning text-decoration-none" href="#terms">Warunki u≈ºytkowania</a></li>
            <li><a class="link-warning text-decoration-none" href="#accessibility">Dostƒôpno≈õƒá</a></li>
          </ul>
        </div>
        <div>
          <h3 class="h6 text-white">Kontakt i pomoc</h3>
          <ul class="list-unstyled mb-0">
            <li><a class="link-warning text-decoration-none" href="mailto:info@monitor-legislacyjny.gov.pl">info@monitor-legislacyjny.gov.pl</a></li>
            <li><a class="link-warning text-decoration-none" href="tel:+48123123123">+48 12 312 31 23</a></li>
            <li><a class="link-warning text-decoration-none" href="#support">Wsparcie techniczne</a></li>
            <li><a class="link-warning text-decoration-none" href="#report">Zg≈Ço≈õ b≈ÇƒÖd</a></li>
          </ul>
        </div>
      </div>
      <div class="border-top border-secondary mt-3 pt-3 small text-white-50">
        ¬© 2025 Kancelaria Prezesa RzƒÖdu. Wszystkie prawa zastrze≈ºone. Serwis dostƒôpny 24/7 | WCAG 2.1 AA | <a class="link-warning text-decoration-none" href="#gdpr">RODO</a>
      </div>
    </div>
  </footer>

<script>
// -------------------- Data (same as original) --------------------
const projects = [
  { id: "AI-001", title: "Ustawa o sztucznej inteligencji", topic: "AI", stage: "sejm", progressPct: 62, owner: "MC", nextMilestone: "II czytanie", impact: { finance: 55, operations: 40, social: 70 }, consultations: [
    { phase: "prekonsultacje", from: "2025-02-10", to: "2025-03-01" },
    { phase: "konsultacje", from: "2025-03-15", to: "2025-04-10" },
  ] },
  { id: "CYB-014", title: "Nowelizacja ustawy o krajowym systemie cyberbezpiecze≈Ñstwa", topic: "Cybersecurity", stage: "rzƒÖd", progressPct: 38, owner: "KPRM", nextMilestone: "Komitet Sta≈Çy RM", impact: { finance: 35, operations: 60, social: 45 }, consultations: [
    { phase: "prekonsultacje", from: "2025-01-20", to: "2025-02-05" },
  ] },
  { id: "DATA-022", title: "Ustawa o ochronie danych w us≈Çugach cyfrowych", topic: "Data", stage: "prekonsultacje", progressPct: 12, owner: "UODO", nextMilestone: "Publikacja za≈Ço≈ºe≈Ñ", impact: { finance: 25, operations: 30, social: 50 }, consultations: [] },
  { id: "AI-009", title: "Zmiana ustawy ‚Äì prawo zam√≥wie≈Ñ publicznych (AI w zam√≥wieniach)", topic: "AI", stage: "senat", progressPct: 78, owner: "UZP", nextMilestone: "Posiedzenie Senatu", impact: { finance: 40, operations: 55, social: 35 }, consultations: [
    { phase: "konsultacje", from: "2025-04-01", to: "2025-04-20" },
  ] },
  { id: "CYB-020", title: "RozporzƒÖdzenie o incydentach w sektorze publicznym", topic: "Cybersecurity", stage: "publikacja", progressPct: 100, owner: "ABW", nextMilestone: "Wej≈õcie w ≈ºycie", impact: { finance: 30, operations: 65, social: 30 }, consultations: [] }
];

const stagesOrder = ["prekonsultacje","konsultacje","rzƒÖd","sejm","senat","prezydent","publikacja"];
const lines = [
  { key: "AI", label: "Temat: Sztuczna inteligencja" },
  { key: "Cybersecurity", label: "Temat: Cyberbezpiecze≈Ñstwo" },
  { key: "Data", label: "Temat: Dane i prywatno≈õƒá" },
];

const alerts = [
  { title: "Zmiana terminu konsultacji: Ustawa o AI", time: "Dzi≈õ, 10:15", detail: "Przed≈Çu≈ºono konsultacje do 10.04.2025" },
  { title: "Aktualizacja tekstu: KSC", time: "Wczoraj, 16:02", detail: "Dodano rozdzia≈Ç dot. wymog√≥w raportowania" },
  { title: "Publikacja: Incydenty w sektorze publicznym", time: "Wczoraj, 09:30", detail: "RozporzƒÖdzenie opublikowane w Dz.U." },
];

const consultations = [
  { title: "Ustawa o AI ‚Äì konsultacje", from: "2025-03-15", to: "2025-04-10", link: "#", owner: "MC", status: "aktywne" },
  { title: "Prawo zam√≥wie≈Ñ publicznych ‚Äì AI", from: "2025-04-01", to: "2025-04-20", link: "#", owner: "UZP", status: "nadchodzƒÖce" },
  { title: "Ochrona danych ‚Äì prekonsultacje", from: "2025-02-10", to: "2025-03-01", link: "#", owner: "UODO", status: "zako≈Ñczone" },
];

const changes = [
  { date: "2025-12-05", project: "Ustawa o AI", change: "Aktualizacja tekstu - dodano rozdzia≈Ç o przejrzysto≈õci", type: "update" },
  { date: "2025-12-04", project: "KSC", change: "Zmiana terminu: sesja przesuniƒôta na 10.12", type: "schedule" },
  { date: "2025-12-03", project: "Prawo zam√≥wie≈Ñ publicznych", change: "Rozpoczƒôcie konsultacji spo≈Çecznych", type: "consultation" },
  { date: "2025-12-02", project: "Ustawa o AI", change: "Nowy projekt dodany - faza prekonsultacji", type: "new" },
  { date: "2025-12-01", project: "Ochrona danych", change: "Opublikowany raport OSR", type: "report" },
  { date: "2025-11-30", project: "Cyberbezpiecze≈Ñstwo", change: "Zatwierdzono przez Radƒô Ministr√≥w", type: "approved" },
  { date: "2025-11-29", project: "Ustawa o AI", change: "Dodano opiniƒô Sejmu", type: "opinion" },
];

const reportTemplates = [
  { name: "Raport tygodniowy", period: "7 dni" },
  { name: "Raport miesiƒôczny", period: "30 dni" },
  { name: "Raport tematyczny", period: "custom" },
  { name: "Raport do zarzƒÖdzania ryzykiem", period: "all" },
];

// -------------------- Helpers --------------------
function formatStageTag(stage) {
  const map = {
    "prekonsultacje": { label: "Prekonsultacje", cls: "pre" },
    "konsultacje": { label: "Konsultacje spo≈Çeczne", cls: "consult" },
    "rzƒÖd": { label: "RzƒÖd", cls: "gov" },
    "sejm": { label: "Sejm", cls: "sejm" },
    "senat": { label: "Senat", cls: "senat" },
    "prezydent": { label: "Prezydent", cls: "prez" },
    "publikacja": { label: "Publikacja (Dz.U.)", cls: "pub" },
  };
  const m = map[stage] || { label: stage, cls: "gov" };
  return `<span class="badge bg-body border text-dark d-inline-flex align-items-center gap-2"><span class="dot ${m.cls}"></span>${m.label}</span>`;
}

// -------------------- Rendering --------------------
function renderTrainBoard() {
  const board = document.getElementById("trainBoard");
  if (!board) return;
  board.innerHTML = "";

  const topicFilter = (document.getElementById("priority") || {}).value || "all";
  const stageFilter = (document.getElementById("stage") || {}).value || "all";
  const query = ((document.getElementById("search") || {}).value || "").trim().toLowerCase();

  lines.forEach(line => {
    const items = projects.filter(p =>
      p.topic === line.key &&
      (topicFilter === "all" || p.topic === topicFilter) &&
      (stageFilter === "all" || p.stage === stageFilter) &&
      (query === "" || p.title.toLowerCase().includes(query) || p.id.toLowerCase().includes(query))
    );
    if (items.length === 0) return;

    const lineEl = document.createElement("div");
    lineEl.className = "train-line";
    lineEl.innerHTML = `<h3 class="h6 m-0 mb-2">${line.label}</h3><div class="wagons" role="list" aria-label="Wagony projekt√≥w"></div>`;
    const wagonsEl = lineEl.querySelector(".wagons");

    items.sort((a,b) => stagesOrder.indexOf(a.stage) - stagesOrder.indexOf(b.stage));

    items.forEach(p => {
      const w = document.createElement("div");
      w.className = "wagon";
      w.setAttribute("role","listitem");
      w.innerHTML = `
        <div class="title">${p.title}</div>
        <div class="meta">ID: ${p.id} ‚Ä¢ W≈Ça≈õciciel: ${p.owner}</div>
        <div class="status">${formatStageTag(p.stage)} ‚Ä¢ Nastƒôpny krok: <span class="status-tag">${p.nextMilestone}</span></div>
        <div class="progress"><div class="bar" style="width:${p.progressPct}%"></div></div>
        <div class="actions">
          <button class="btn btn-sm btn-outline-secondary" aria-label="Szczeg√≥≈Çy projektu" onclick="openProject('${p.id}')">Szczeg√≥≈Çy</button>
          <button class="btn btn-sm btn-outline-secondary" aria-label="Dodaj alert" onclick="addAlert('${p.id}')">Alert</button>
          <button class="btn btn-sm btn-outline-secondary" aria-label="Dodaj do raportu" onclick="addToReport('${p.id}')">Do raportu</button>
          <button class="btn btn-sm btn-outline-secondary" aria-label="Poka≈º konsultacje" onclick="openConsultations('${p.id}')">Konsultacje</button>
          <button class="btn btn-sm btn-outline-secondary" aria-label="Analiza wp≈Çywu" onclick="openImpact('${p.id}')">Impact</button>
        </div>
      `;
      wagonsEl.appendChild(w);
    });

    board.appendChild(lineEl);
  });

  if (!board.innerHTML) {
    board.innerHTML = `<p>Brak projekt√≥w dla wybranych filtr√≥w.</p>`;
  }
}

function renderSummary() {
  const box = document.getElementById("dailySummary");
  if (!box) return;
  box.innerHTML = "";
  projects.slice(0, 3).forEach(p => {
    const item = document.createElement("div");
    item.className = "border rounded p-2";
    item.innerHTML = `
      <div class="fw-semibold">${p.title}</div>
      <div class="text-muted small">Etap: ${p.stage} ‚Ä¢ Nastƒôpny krok: ${p.nextMilestone}</div>
    `;
    box.appendChild(item);
  });
}

function renderConsultations() {
  const box = document.getElementById("consultationsFeed");
  if (!box) return;
  box.innerHTML = "";
  consultations.forEach(c => {
    const item = document.createElement("div");
    item.className = "border rounded p-3";
    item.innerHTML = `
      <div class="fw-semibold">${c.title}</div>
      <div class="text-muted small mb-1">${c.status} ‚Ä¢ ${c.from} ‚Üí ${c.to} ‚Ä¢ Organizator: ${c.owner}</div>
      <div>Link: <a href="${c.link}" aria-label="Przejd≈∫ do konsultacji">Strona konsultacji</a></div>
      <div class="mt-2 d-flex gap-2 flex-wrap">
        <button class="btn btn-sm btn-outline-secondary" onclick="subscribeConsultation('${c.title}')">Subskrybuj</button>
        <button class="btn btn-sm btn-outline-secondary" onclick="commentConsultation('${c.title}')">Dodaj opiniƒô</button>
      </div>
    `;
    box.appendChild(item);
  });
}

function renderImpactGrid() {
  const grid = document.getElementById("impactGrid");
  if (!grid) return;
  grid.innerHTML = "";
  projects.forEach(p => {
    const col = document.createElement("div");
    col.className = "col";
    col.innerHTML = `
      <div class="card h-100">
        <div class="card-body">
          <h4 class="h6">${p.title}</h4>

          <div class="impact-meter" aria-label="Wska≈∫nik wp≈Çywu finansowego">
            <div class="mbar" style="width:${p.impact.finance}%"></div>
          </div>
          <div class="text-muted small">Finanse publiczne: ${p.impact.finance}%</div>

          <div class="impact-meter mt-2" aria-label="Wska≈∫nik wp≈Çywu operacyjnego">
            <div class="mbar" style="width:${p.impact.operations}%"></div>
          </div>
          <div class="text-muted small">Operacje: ${p.impact.operations}%</div>

          <div class="impact-meter mt-2" aria-label="Wska≈∫nik wp≈Çywu spo≈Çecznego">
            <div class="mbar" style="width:${p.impact.social}%"></div>
          </div>
          <div class="text-muted small">Spo≈Çeczne: ${p.impact.social}%</div>

          <div class="mt-2 d-flex gap-2 flex-wrap">
            <button class="btn btn-sm btn-outline-secondary" onclick="openOsr('${p.id}')">OSR / szczeg√≥≈Çy</button>
            <button class="btn btn-sm btn-outline-secondary" onclick="simulateRisk('${p.id}')">Symuluj ryzyka</button>
            <button class="btn btn-sm btn-outline-secondary" onclick="addToReport('${p.id}')">Dodaj do raportu</button>
          </div>
        </div>
      </div>
    `;
    grid.appendChild(col);
  });
}

function renderAlerts() {
  const box = document.getElementById("alertsFeed");
  if (!box) return;
  box.innerHTML = "";
  alerts.forEach(a => {
    const item = document.createElement("div");
    item.className = "border rounded p-3";
    item.innerHTML = `
      <div class="fw-semibold">${a.title}</div>
      <div class="text-muted small">${a.time}</div>
      <div>${a.detail}</div>
    `;
    box.appendChild(item);
  });
}

function renderChangeLog() {
  const box = document.getElementById("changeLog");
  if (!box) return;
  box.innerHTML = "";
  const recentChanges = changes.slice(0, 5);
  recentChanges.forEach(c => {
    const item = document.createElement("div");
    item.className = "border rounded p-3";
    const typeLabel = {
      "new": "üÜï Nowy projekt",
      "update": "üìù Aktualizacja",
      "consultation": "üí¨ Konsultacje",
      "schedule": "üìÖ Zmiana harmonogramu",
      "report": "üìä Raport",
      "approved": "‚úÖ Zatwierdzone",
      "opinion": "üí≠ Opinia"
    }[c.type] || "üìå Zmiana";
    item.innerHTML = `
      <div class="fw-semibold">${typeLabel} - ${c.project}</div>
      <div class="text-muted small">${c.date}</div>
      <div>${c.change}</div>
    `;
    box.appendChild(item);
  });
}

// -------------------- Tracking / Access / Actions --------------------
function initializeTracking() {
  const trackingScope = document.getElementById("trackingScope");
  const notificationMethod = document.getElementById("notificationMethod");
  const saveBtn = document.getElementById("saveTracking");
  const trackingStatus = document.getElementById("trackingStatus");
  if (!saveBtn) return;

  saveBtn.addEventListener("click", () => {
    const scope = trackingScope ? trackingScope.value : 'all';
    const method = notificationMethod ? notificationMethod.value : 'none';

    let earlyProjects = projects;
    if (scope === "early") earlyProjects = projects.filter(p => p.stage === "prekonsultacje");
    else if (scope === "consultation") earlyProjects = projects.filter(p => ["prekonsultacje", "konsultacje"].includes(p.stage));
    else if (scope === "active") earlyProjects = projects.filter(p => !["publikacja"].includes(p.stage));

    localStorage.setItem("trackingScope", scope);
    localStorage.setItem("notificationMethod", method);
    localStorage.setItem("trackedProjects", JSON.stringify(earlyProjects.map(p => p.id)));

    if (trackingStatus) {
      trackingStatus.style.display = "block";
      setTimeout(() => trackingStatus.style.display = "none", 3000);
    }
    console.log(`≈öledzenie ${scope} - powiadomienia: ${method}`);
  });
}

function initializeUserAccess() {
  const userRole = document.getElementById("userRole");
  if (!userRole) return;

  function applyRole(role) {
    const officialIds = ["viewFullChangelog", "compareVersions", "configureAlerts", "addProjectBtn"];
    officialIds.forEach(id => {
      const el = document.getElementById(id);
      if (el) el.style.display = role === "official" ? "" : "none";
    });

    const addBtn = document.getElementById('addProjectBtn');
    if (addBtn) {
      addBtn.onclick = () => {
        if (role !== 'official') { alert('Dodawanie projekt√≥w jest dostƒôpne tylko dla urzƒôdnik√≥w.'); return; }
        addProject();
      };
    }

    const quickAddItem = document.getElementById('quickAddItem');
    const exportItem = document.getElementById('exportItem');
    if (quickAddItem) quickAddItem.style.display = role === 'official' ? '' : 'none';
    if (exportItem) exportItem.style.display = role === 'official' ? '' : 'none';
  }

  userRole.addEventListener("change", (e) => {
    const role = e.target.value;
    applyRole(role);
    localStorage.setItem("userRole", role);
    console.log(`Rola u≈ºytkownika zmieniona na: ${role}`);
  });

  const initRole = localStorage.getItem('userRole') || userRole.value;
  userRole.value = initRole;
  applyRole(initRole);
}

function initializeVersionComparison() {
  const compareBtn = document.getElementById("compareVersions");
  if (!compareBtn) return;
  compareBtn.addEventListener("click", () => {
    alert("Por√≥wnanie wersji:\n\n" +
      "Wersja 1 (2025-12-01): Tekst 1000 s≈Ç√≥w\n" +
      "Wersja 2 (2025-12-05): Tekst 1150 s≈Ç√≥w\n\n" +
      "Zmiany:\n" +
      "- Dodano 150 s≈Ç√≥w\n" +
      "- Zmieniono 8 paragraf√≥w\n" +
      "- Usuniƒôto 1 rozdzia≈Ç");
  });
}

function initializeFullChangelog() {
  const viewBtn = document.getElementById("viewFullChangelog");
  if (!viewBtn) return;
  viewBtn.addEventListener("click", () => {
    let log = "PE≈ÅNY DZIENNIK ZMIAN\n\n";
    changes.forEach(c => { log += `${c.date} - ${c.project}: ${c.change}\n`; });
    alert(log);
  });
}

// -------------------- Simple language --------------------
function simplifyText(input) {
  if (!input || input.trim().length === 0) return "Wklej tekst, a upro≈õcimy go.";
  let t = input;
  const map = [
    { from: /niniejsze rozporzƒÖdzenie/gmi, to: "ten dokument" },
    { from: /podmiot zobowiƒÖzany/gmi, to: "instytucja lub firma, kt√≥ra musi to zrobiƒá" },
    { from: /niezw≈Çocznie/gmi, to: "tak szybko, jak to mo≈ºliwe" },
    { from: /w≈Ça≈õciwy organ/gmi, to: "odpowiedni urzƒÖd" },
    { from: /regulamin/gmi, to: "zasady" },
    { from: /uchyla siƒô/gmi, to: "przestaje obowiƒÖzywaƒá" },
    { from: /wchodzi w ≈ºycie/gmi, to: "zaczyna obowiƒÖzywaƒá" },
    { from: /akt normatywny/gmi, to: "przepis" },
  ];
  map.forEach(r => { t = t.replace(r.from, r.to); });
  const effects = [];
  if (/op≈Çaty|koszt/i.test(input)) effects.push("Mo≈ºe zmieniƒá op≈Çaty lub koszty.");
  if (/termin|deadline|dni/i.test(input)) effects.push("Wprowadza konkretne terminy wykonania.");
  if (/obowiƒÖzek|zobowiƒÖzany/i.test(input)) effects.push("Nak≈Çada obowiƒÖzki na wskazane podmioty.");
  if (/kary|sankcje|mandat/i.test(input)) effects.push("Przewiduje sankcje za niewykonanie.");
  const summary = effects.length ? "\n\nSkutki prawne (prostym jƒôzykiem):\n- " + effects.join("\n- ") : "";
  return t + summary;
}

// -------------------- Section switching (SPA-like) --------------------

const sectionIds = ['legislative','consultations','tracking','tracking-console','impact','alerts','simple','access'];

function showSection(id) {
  // Hide all top-level sections
  sectionIds.forEach(sid => {
    const el = document.getElementById(sid);
    if (el) el.style.display = 'none';
  });

  // Show selected section
  const el = document.getElementById(id);
  if (el) el.style.display = '';

  // Show tracking-console only with tracking
  const tc = document.getElementById('tracking-console');
  if (tc) tc.style.display = (id === 'tracking') ? '' : 'none';

  // Quick Actions aside: only on "access"
  const quickAside = document.getElementById('quickActionsAside');
  if (quickAside) quickAside.style.display = (id === 'access') ? '' : 'none';

  // Center wagons only in legislative
  document.querySelectorAll('.wagons').forEach(w => {
    w.style.justifyContent = (id === 'legislative') ? 'center' : 'flex-start';
  });

  // Update nav active
  document.querySelectorAll('nav .nav-link').forEach(a => a.classList.remove('active'));
  document.querySelector(`nav .nav-link[data-section="${id}"]`)?.classList.add('active');

  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// -------------------- Wire up events --------------------
document.addEventListener('DOMContentLoaded', () => {
  // Nav
  document.querySelectorAll('nav [data-section]').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const id = link.getAttribute('data-section');
      showSection(id);
    });
  });

  // Filters
  const priority = document.getElementById('priority');
  const stage = document.getElementById('stage');
  const searchInput = document.getElementById('search');
  const resetBtn = document.getElementById('resetFilters');

  function onFiltersChanged() { renderTrainBoard(); }
  if (priority) priority.addEventListener('change', onFiltersChanged);
  if (stage) stage.addEventListener('change', onFiltersChanged);
  if (searchInput) searchInput.addEventListener('input', onFiltersChanged);
  if (resetBtn) resetBtn.addEventListener('click', () => {
    if (priority) priority.value = 'all';
    if (stage) stage.value = 'all';
    if (searchInput) searchInput.value = '';
    renderTrainBoard();
  });

  // Global search enter-to-filter
  const globalSearch = document.getElementById("globalSearch");
  if (globalSearch) {
    globalSearch.addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        const query = e.target.value.toLowerCase();
        const localSearch = document.getElementById("search");
        if (localSearch) localSearch.value = query;
        showSection('legislative');
        renderTrainBoard();
        e.target.value = "";
        const leg = document.getElementById("legislative");
        if (leg) leg.scrollIntoView({ behavior: "smooth" });
      }
    });
  }

  // Simple language
  const simplifyBtn = document.getElementById('simplifyBtn');
  if (simplifyBtn) {
    simplifyBtn.addEventListener('click', () => {
      const src = (document.getElementById('plainInput') || {}).value || '';
      const outEl = document.getElementById('plainOutput');
      if (!src.trim()) { if (outEl) outEl.textContent = 'Wklej tekst do uproszczenia.'; return; }
      if (outEl) outEl.textContent = simplifyText(src);
    });
  }

  // Quick actions basic handlers (same UX as original)
  document.getElementById('configureAlerts')?.addEventListener('click', () => alert('Konfiguracja alert√≥w‚Ä¶'));
  document.getElementById('viewFullChangelog')?.addEventListener('click', () => alert('Pe≈Çny dziennik zmian‚Ä¶'));
  document.getElementById('compareVersions')?.addEventListener('click', () => alert('Por√≥wnywanie wersji‚Ä¶'));

  // Initial renders
  renderTrainBoard();
  renderSummary();
  renderConsultations();
  renderImpactGrid();
  renderAlerts();
  renderChangeLog();

  // Initialize features
  initializeTracking();
  initializeUserAccess();
  initializeVersionComparison();
  initializeFullChangelog();

  // Default view
  showSection('legislative');
});

// -------------------- Actions (same as original) --------------------
function openProject(id) { alert("Szczeg√≥≈Çy projektu: " + id); }
function addAlert(id) { alert("Dodano alert dla projektu: " + id); }
function addToReport(id) { alert("Dodano do raportu: " + id); }
function openConsultations(id) {
  const p = projects.find(x => x.id === id);
  if (!p || !p.consultations || p.consultations.length === 0) { alert("Brak konsultacji dla: " + id); return; }
  const info = p.consultations.map(c => `${c.phase}: ${c.from} ‚Üí ${c.to}`).join("\n");
  alert("Konsultacje dla " + p.title + ":\n" + info);
}
function openImpact(id) { alert("Analiza wp≈Çywu dla: " + id); }
function subscribeConsultation(title) { alert("Subskrypcja konsultacji: " + title); }
function commentConsultation(title) { alert("Dodaj opiniƒô do: " + title); }
function openOsr(id) { alert("OSR dla projektu: " + id); }
function simulateRisk(id) { alert("Symulacja ryzyk dla: " + id); }

// Add project with role check
function addProject() {
  const userRole = (document.getElementById('userRole') || {}).value || localStorage.getItem('userRole');
  if (userRole !== 'official') { alert('Dodawanie projekt√≥w jest dostƒôpne tylko dla urzƒôdnik√≥w.'); return; }
  const title = prompt('Nazwa projektu ustaw (kr√≥tka):');
  if (!title) return;
  const id = 'NEW-' + Math.random().toString(36).slice(2,8).toUpperCase();
  const newP = { id, title, topic: 'AI', stage: 'prekonsultacje', progressPct: 5, owner: 'Anon', nextMilestone: 'Rejestracja', impact: { finance: 0, operations: 0, social: 0 }, consultations: [] };
  projects.unshift(newP);
  renderTrainBoard();
  renderSummary();
  renderImpactGrid();
  alert('Projekt dodany: ' + title);
}

// Bind Add button (also managed by role logic)
document.getElementById('addProjectBtn')?.addEventListener('click', () => addProject());
</script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
